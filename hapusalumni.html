<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Hapus Data Alumni</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <style>
    .jarak { padding-top: 30px; }
  </style>
</head>
<body>
  <div class="container">
    <h3>Hapus Data Alumni</h3>

    <div class="alert alert-primary" id="sukses">Penghapusan Data Alumni Berhasil</div> 
    <div class="alert alert-danger" id="gagal">Penghapusan Data Alumni Gagal</div> 

    <form id="formDataAlumni" method="POST" action="">
      <div class="form-group">
        <label class="form-label">ID Alumni</label>
        <input class="form-control" type="text" name="txID" id="txID" disabled />
      </div>
      <div class="form-group">
        <label class="form-label">Nama Lengkap</label>
        <input class="form-control" type="text" name="txNAMA_LENGKAP" id="txNAMA_LENGKAP" disabled />
      </div>
      <div class="form-group">
        <label class="form-label">Tanggal Lahir</label>
        <input class="form-control" type="date" name="txTGL" id="txTGL" disabled />
      </div>
      <div class="form-group">
        <label class="form-label">Jenis Kelamin</label>
        <select class="form-control" name="txJK" id="txJK" disabled>
          <option disabled selected>Pilih Jenis Kelamin</option>
          <option value="Laki-laki">Laki-laki</option>
          <option value="Perempuan">Perempuan</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Program Studi</label>
        <input class="form-control" type="text" name="txPRODI" id="txPRODI" disabled />
      </div>
      <div class="form-group">
        <label class="form-label">No Telepon</label>
        <input class="form-control" type="text" name="txTELP" id="txTELP" disabled />
      </div>
      <div class="form-group">
        <label class="form-label">Alamat</label>
        <input class="form-control" type="text" name="txALAMAT" id="txALAMAT" disabled />
      </div>

      <div class="form-group jarak">
        <button type="submit" id="cmdHapus" class="btn btn-danger">Hapus</button>
        <a class="btn btn-warning" href="dataalumni.html">Batal</a>
      </div>
    </form>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js" crossorigin="anonymous"></script>
  
  <script>
    // Fungsi ambil data alumni berdasarkan id_alumni dari URL
    function caridata() {
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id_alumni");  // Pastikan parameter URL sesuai

      if(!id){
        $("#gagal").show().text("ID Alumni tidak ditemukan di URL.");
        return;
      }

      $.ajax({
        url: "server/alumnibyalumniid.php",
        type: "GET",
        dataType: "json",
        data: { id_alumni: id },
        success: function(res){
          if(res.error === 0 && res.isi){
            $("#txID").val(res.isi.id_alumni);
            $("#txNAMA_LENGKAP").val(res.isi.nama_lengkap);
            $("#txTGL").val(res.isi.tanggal_lahir);
            $("#txJK").val(res.isi.jenis_kelamin);
            $("#txPRODI").val(res.isi.program_studi);
            $("#txTELP").val(res.isi.no_telepon);
            $("#txALAMAT").val(res.isi.alamat);
            $("#gagal").hide();
          } else {
            $("#gagal").show().text(res.message || "Data alumni tidak ditemukan.");
          }
        },
        error: function(){
          $("#gagal").show().text("Gagal mengambil data dari server.");
        }
      });
    }

    $(function(){
      $("#sukses").hide();
      $("#gagal").hide();
      caridata();

      $("#formDataAlumni").submit(function(e){
        e.preventDefault();

        let id = $("#txID").val();
        if(!id){
          $("#gagal").show().text("ID Alumni tidak ditemukan.");
          return;
        }

        let dta = `txID=${encodeURIComponent(id)}`;
        let urltarget = "server/alumnidestroy.php";

        $.ajax({
          url: urltarget,
          type: "POST",
          dataType: "json",
          data: dta,
          success: function(hsl){
            if(hsl.error == 0){
              $("#sukses").show().text("Penghapusan sukses dilaksanakan");
              $("#gagal").hide();
              setTimeout(() => window.location.href = "dataalumni.html", 2000);
            } else {
              $("#gagal").show().text(hsl.message || "Penghapusan gagal dilaksanakan");
              $("#sukses").hide();
            }
          },
          error: function(){
            $("#gagal").show().text("Penghapusan gagal dilaksanakan");
            $("#sukses").hide();
          }
        });
      });
    });
  </script>
</body>
</html>
